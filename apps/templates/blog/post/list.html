{% extends "base.html" %}
{% load blog_tags %}

{% block title %}Blog{% endblock title %}

{% block content %}

<div class="container-fluid">
    <div class="row p-5">
        <div class="col-8 px-5">

            <section>

                {% for post in posts %}
            
                <div class="card my-3">
                    <div class="card-body">
                        <h2 class="card-title"><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h2>
                        <div class="text-muted">
                            Tags:
                            {% for tag in post.tags.all %}
                                <a href="{% url 'blog:post_list_by_tag' tag.slug %}">
                                    <span class="badge rounded-pill bg-light text-muted">{{ tag.name }}</span>
                                </a>
                                {% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                        <span class="text-muted mb-2">Published: {{ post.published_at }} by {{ post.author }}</span>
                        <p class="card-text">{{ post.body|markdown|truncatewords_html:30 }}</p>
                    </div>
                </div>
            
                {% endfor %}
            
            </section>

        </div>

        <div class="col-4 p-3">

            <section>
                <div class="card">
                    <div class="card-body">
                        <div class="card-text text-center fw-bolder">
                            Want to get them while they're hot üçû üòù
                            <a href="{% url 'blog:post_feed' %}">Subscribe to my RSS feed.</a>
                        </div>
                    </div>
                </div>
            </section>
        
            <section>
                <div class="p-3">
                    <h3>Latest Posts</h3>
                    {% show_latest_posts %}
                </div>
            </section>
        
            <section>
                <div class="p-3">
                    <h3>Most Commented Posts</h3>
                    {% get_most_commented_posts as popular_posts %}
                    <ul>
                        {% for post in popular_posts %}
                            <li><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </section>
            
        </div>
    </div>
</div>

<section>
    {% if tag %}
        <h2>Posts tagged with "{{ tag.name }}"</h2>
    {% endif %}
</section>


    
{% include "pagination.html" with page=posts %}
{% endblock content %}